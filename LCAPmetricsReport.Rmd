---
output: 
    html_document:
        theme: readable
params:
    dist: "27661590000000"
---

<a href="https://github.com/dobrowski/LCAPmetrics" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(here)
library(rmarkdown)
library(knitr)
library(tidyverse)
library(glue)
library(DT)

dist <- params$dist

indicators <- read_rds("indicators.rds")
metrics <- read_rds("metrics.rds")
dashboard_mry <- read_rds("dashboard_mry.rds")
csi_mry <- read_rds("csi_mry.rds")
undup.count <- read_rds("undup.rds")
dash.mry.da <- read_rds("dash_mry_da.rds")


colorize <- function(x, color) {
  if (knitr::is_latex_output()) {
    sprintf("\\textcolor{%s}{%s}", color, x)
  } else if (knitr::is_html_output()) {
    sprintf("<span style='color: %s;'>%s</span>", color, 
      x)
  } else x
}


ind_dist <- indicators %>%
    filter(cds == dist) 

metrics_dist <- ind_dist %>% 
    t() %>%
    as.data.frame() %>%
    transmute(metrics = row.names(.),
           rate = as.character(.$V1)
           )

joinder <- left_join(metrics, metrics_dist) %>%
    mutate(sentence = if_else(is.na(rate),
                              colorize( glue("<p style='background-color:wheat;'>The {description} is unavailable in public data sets.  It can be located in {source}. {notes} </p>"),"darkgray"),
                              colorize( glue("<p style='background-color:sandybrown;'> The {description} for {year} is ***{rate}*** based on data from {website}. {notes} </p>"
                                             ), "black")
                              )
    )

# write_csv(joinder  ,here("output",paste0(metrics_dist[18,2]," data.csv" ) ))

```



---
title: `r metrics_dist[4,2]` 2022 LCAP Metrics Report
---


## Report Purpose

The purpose of this project is to provide all districts with as many of the required LCAP metrics as possible. It draws on public datasources including the California Dashboard and CDE's downloadable data files (https://www.cde.ca.gov/ds/sd/sd/). It is meant to save time looking things up, and is completely optional to use. Items with grey text and light brown background do not have publicly available data for your LEA, whereas items in black and the darker brown do have data to present. Your LEA may not have data available because that indicator does not apply such as elementary districts and graduation rate. 

Please note that the most recently available data is used, with a prefernce for the California Dashboard.  Additional data represented comes from DataQuest.  Most data reflect the 2021-22 school year, but in some case may represent the current school year or prior years. MCOE and CDE also encourage you to use current local data from your School Information System or other sources.  



-----------

## LCAP Identified Need Section


These data points need to be included in the Identified Need section of the Plan Summary, along with steps being taken to address them.  Additional identified needs from local data or stakeholder processes can also be included. 

```{r needs, echo=FALSE, include=FALSE}

ind_long_names <- tibble(indicator = c("cci","elpi","ela", "math", "grad", "chronic", "susp"),
                         long = c("College and Career", "English Language Progress Indicator", "English Language Arts CAASPP scores", "Math CAASPP scores", "Graduation Rate", "Chronic Absenteeism", "Suspensions"))

studentgroups <- tibble(name = c("ALL", "AA", "AI", "AS", "FI", "HI", "PI", "WH", "MR", "EL", "ELO", "EO", "SED", "SWD", "FOS", "HOM"),
                        descriptive = c(
                            "All Students",
                            "Black/African American",
                            "American Indian or Alaska Native",
                            "Asian",
                            "Filipino",
                            "Hispanic",
                            "Pacific Islander",
                            "White",
                            "Multiple Races/Two or More",
                            "English Learner",
                            "English Learner Only",
                            "English Only",
                            "Socioeconomically Disadvantaged",
                            "Students with Disabilities",
                            "Foster",
                            "Homeless")
)



lea.need <- dashboard_mry %>% 
    filter(cds == dist,
           studentgroup == "ALL",
           statuslevel == 1
#           color %in% c(1,2)
    ) %>%
    select(indicator) %>%
    left_join(ind_long_names)


lea.sub.low <- dashboard_mry %>%
    filter(cds == dist) %>%
#    select(cds,ind, studentgroup, color) %>%
    select(indicator, studentgroup, statuslevel) %>%
    filter(statuslevel >0) %>%
    group_by(indicator) %>%
    pivot_wider(names_from = studentgroup, values_from = statuslevel) %>%
    pivot_longer(cols = -c(ALL, indicator) ) %>%
    mutate(diff = ALL - value) %>%
    filter(!is.na(value) & value != 0) %>%
    filter(diff >= 2) %>%
    left_join(ind_long_names) %>%
    left_join(studentgroups) %>%
    mutate(phrases = glue("{descriptive} youth for {long}"))

# Blocked out for this year since not relevant

redorange <- if ( length( lea.need$long) > 0 ) combine_words( lea.need$long) else
                       "No indicators"

student.need <- if ( length( lea.sub.low$phrases) > 0 ) combine_words( lea.sub.low$phrases) else
                       "No student groups"


### DA ----

da.dist <- dash.mry.da %>%
    filter(cds == dist) %>%
    select(studentgroup.long,indicator2)


```

### Indicators which are Lowest Status overall 

`r redorange` were the lowest status on the dashboard for ALL students overall.


### Student groups whose performance level was two or more levels below students overall

`r student.need` were two or more performance levels below ALL students in the district.

### DA Eligible

```{r da-table, echo=FALSE}
datatable(da.dist,
          colnames = c("Student Group", "Indicator"),
          caption = "Student Groups Qualifying for DA on 2022 Dashboard",
          rownames = FALSE,
          
          options = list(pageLength = 20,
                         lengthChange = FALSE,
                         searching = FALSE,
                         dom = 't')) 
```

### DA Districts Additional Report

If your district is eligible for DA, you can find additional data at https://da-monterey.netlify.app/

-----------

## CSI-identified Schools 


```{r csi, echo=FALSE, include=FALSE}


csi <- csi_mry %>% 
    filter(cds == dist) 

csi.words <- if ( length( csi$schoolname) > 0 ) paste0(combine_words( csi$schoolname), " have been identified as CSI schools.") else "There are no schools in the district identified for CSI and the section can be skipped by entering 'N/A'."

```

~~The official list of CSI schools will be released by CDE in early 2023.~~

~~`r csi.words`~~



------


## Required Metrics

```{r loop, results = "asis", echo=FALSE,  include=FALSE}

out = NULL

for(i in 1:nrow(joinder)) {
    
     out <- c(out, knit_child('child.Rmd'))
}

```


```{r output, results = "asis", echo=FALSE}
cat(paste(out, collapse = '\n'))
```


-----------

## Unduplicated Percentage


```{r undup, echo=FALSE, include=FALSE}


undup <- undup.count %>% 
    filter(cds == dist) 

undup.words <- glue( "The most recent percentage of unduplicated students from https://www.cde.ca.gov/ds/sd/sd/filescupc.asp was **{ scales::percent( undup$undup.perc , accuracy = .1 ) }**." )

```

`r undup.words`



----------

This report was run at `r Sys.time()`
