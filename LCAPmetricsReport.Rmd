---
output: html_document
params:
    dist: "27661590000000"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(glue)
library(here)
library(knitr)


dist <- params$dist

indicators <- read_rds("indicators.rds")
metrics <- read_rds("metrics.rds")

colorize <- function(x, color) {
  if (knitr::is_latex_output()) {
    sprintf("\\textcolor{%s}{%s}", color, x)
  } else if (knitr::is_html_output()) {
    sprintf("<span style='color: %s;'>%s</span>", color, 
      x)
  } else x
}


ind_dist <- indicators %>%
    filter(cds == dist) 

metrics_dist <- ind_dist %>% 
    t() %>%
    as.data.frame() %>%
    transmute(metrics = row.names(.),
           rate = as.character(V1))

joinder <- left_join(metrics, metrics_dist) %>%
    mutate(sentence = if_else(is.na(rate),
                              colorize( glue("The {description} is unavailable in public data sets.  It can be located in {source}. {notes}"),"lightgray"),
                              colorize( glue("The {description} is {rate} based on data from {website}. {notes}"
                                             ), "black")
                              )
    )

write_csv(joinder  ,here("output",paste0(metrics_dist[18,2]," data.csv" ) ))

```


# `r metrics_dist[18,2]` LCAP Metrics Report


## Report Purpose

The purpose of this project is to provide all districts with as many of the required LCAP metrics as possible. It draws on public datasources including the California Dashboard and CDE's downloadable data files (https://www.cde.ca.gov/ds/sd/sd/). It is meant to save time looking things up, and is completely optional to use. 

------

```{r loop, results = "asis", echo=FALSE,  include=FALSE}

out = NULL

for(i in 1:nrow(joinder)) {
    
     out <- c(out, knit_child('child.Rmd'))
}

```


```{r output, results = "asis", echo=FALSE}
cat(paste(out, collapse = '\n'))
```

This report was run at `r Sys.time()`
