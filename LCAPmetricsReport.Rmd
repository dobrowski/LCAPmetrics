---
output: html_document
params:
    dist: "27661590000000"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(glue)
library(here)
library(knitr)


dist <- params$dist

indicators <- read_rds("indicators.rds")
metrics <- read_rds("metrics.rds")

ind_dist <- indicators %>%
    filter(cds == dist) 



metrics_dist <- ind_dist %>% 
    t() %>%
    as.data.frame() %>%
    transmute(metrics = row.names(.),
           rate = as.character(V1))

joinder <- left_join(metrics, metrics_dist) %>%
    mutate(sentence = if_else(is.na(rate),
                              glue('The "{description}" is unavailable in public data sets.  It can be located in {source}.{notes}'),
                              glue('The "{description}" is {rate} based on data from {website}. {notes}')
    )
    )

write_csv(joinder  ,here("output",paste0(metrics_dist[18,2]," data.csv" ) ))

```

This report was run at `r Sys.time()`


# `r metrics_dist[18,2]`

`r row <- 21`

The `r joinder[row,'description'] %>% simplify()` is `r joinder[row,'rate'] %>% simplify()` based on data from `r joinder[row,'website'] %>% simplify()`.


```{r loop, results = "asis", echo=FALSE,  include=FALSE}

out = NULL



for(i in 1:nrow(joinder)) {
    
     out <- c(out, knit_child('child.Rmd'))
}

```


```{r output, results = "asis", echo=FALSE}
cat(paste(out, collapse = '\n'))


```


