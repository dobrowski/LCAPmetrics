---
output: html_document
params:
    dist: "27661590000000"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(glue)
library(here)
library(knitr)
library(crayon)


dist <- params$dist

indicators <- read_rds("indicators.rds")
metrics <- read_rds("metrics.rds")

colorize <- function(x, color) {
  if (knitr::is_latex_output()) {
    sprintf("\\textcolor{%s}{%s}", color, x)
  } else if (knitr::is_html_output()) {
    sprintf("<span style='color: %s;'>%s</span>", color, 
      x)
  } else x
}


ind_dist <- indicators %>%
    filter(cds == dist) 



metrics_dist <- ind_dist %>% 
    t() %>%
    as.data.frame() %>%
    transmute(metrics = row.names(.),
           rate = as.character(V1))

joinder <- left_join(metrics, metrics_dist) %>%
    mutate(sentence = if_else(is.na(rate),
                              colorize( glue("The {description} is unavailable in public data sets.  It can be located in {source}. {notes}"),"lightgray"),
                              colorize( glue("The {description} is {rate} based on data from {website}. {notes}"
                                             ), "black")
                              )
    )

write_csv(joinder  ,here("output",paste0(metrics_dist[18,2]," data.csv" ) ))

```

This report was run at `r Sys.time()`

`r joinder[1,'sentence']`

`r joinder[2,'sentence']`


# `r metrics_dist[18,2]`


```{r loop, results = "asis", echo=FALSE,  include=FALSE}

out = NULL



for(i in 1:nrow(joinder)) {
    
     out <- c(out, knit_child('child.Rmd'))
}

```


```{r output, results = "asis", echo=FALSE}
cat(paste(out, collapse = '\n'))


```


